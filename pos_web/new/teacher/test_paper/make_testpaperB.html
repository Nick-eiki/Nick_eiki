<!doctype html>
<html id="html">
<head>
<meta charset="utf-8">
<title>教师--个人中心--考试管理--组卷</title>
<link href="../../css/base.css" rel="stylesheet" type="text/css">
<link href="../../css/jquery-ui.css" rel="stylesheet" type="text/css">
<link href="../../css/popBox.css" rel="stylesheet" type="text/css">
<link href="../../css/teacher.css" rel="stylesheet" type="text/css">
<link href="../../js/ztree/zTreeStyle/zTreeStyle.css" rel="stylesheet" type="text/css">
<script src="../../js/jquery-1.7.1.min.js" type="text/javascript"></script>
<script src="../../js/jquery-ui.min.js" type="text/javascript"></script>
<script src="../../js/base.js" type="text/javascript"></script>
<script src="../../js/jquery.validationEngine.min.js" type="text/javascript"></script>
<script src="../../js/jquery.validationEngine-zh_CN.js" type="text/javascript"></script>
<script src="../../js/ztree/jquery.ztree.all-3.5.min.js" type="text/javascript"></script>
<script>
$(function(){
	var zNodes =[
		{ id:1, pId:0, name:"语文"},
		{ id:11, pId:1, name:"拼音"},
		{ id:111, pId:11, name:"声母"},
		{ id:112, pId:11, name:"韵母"},
		{ id:12, pId:1, name:"标点符号"},
		{ id:13, pId:1, name:"造句"},
		{ id:14, pId:1, name:"语法"}
	];
	popBox.pointTree2(zNodes,$('.addPointBtn'))


<!--试卷结构-->

var config= {
    "main_title": {"ischecked": 1,"title": "2013-2014学年度xx学校xx月考卷"},
    "sub_title": {"ischecked": 1,"title": "试卷副标题"},
    "line": {"ischecked": 1},
    "secret_sign": {"ischecked": 1,"title": "绝密★启用前"},
    "info": {"ischecked": 1,"title": 100},
    "student_input": {"ischecked": 1,"title": "学校：________姓名：_______班级：________考号：______"},
    "performance": {"ischecked": 1},
    "pay_attention": {"ischecked": 1,"content": "1. 答题前填写好自己的姓名、班级、考号等信息<br />2. 请将答案正确填写在答题卡上"},
    "win_paper_typeone": {
        "id": 16251354,
        "type": 1,
        "ischecked": 1,
        "title": "分卷I",
        "content": "分卷I 注释",
		"questions":[
			{"id": 66820176,"ischecked": 1, "seq":0, "ischeckedscore": 1,"title": "填空题","content": "注释"},
			{"id": 66820177,"ischecked": 1, "seq":1, "ischeckedscore": 1,"title": "选择题","content": "注释"},
			{"id": 66820178,"ischecked": 1, "seq":2, "ischeckedscore": 1,"title": "应用题","content": "注释"}
		]
    },

    "win_paper_typetwo": {
        "id": 16251355,
        "type": 2,
        "ischecked": 1,
        "title": "分卷II",
        "content": "分卷II 注释",
		"questions":[
			{"id": 66820276,"ischecked": 1, "seq":0, "ischeckedscore": 1,"title": "填空题","content": "注释"},
			{"id": 66820277,"ischecked": 1, "seq":1, "ischeckedscore": 1,"title": "完型填空","content": "注释"},
			{"id": 66820278,"ischecked": 1,	"seq":2, "ischeckedscore": 1,"title": "选择题","content": "注释"},
			{"id": 66820279,"ischecked": 1,	"seq":3, "ischeckedscore": 1,"title": "应用题","content": "注释"},
			{"id": 66820280,"ischecked": 1,	"seq":4, "ischeckedscore": 1,"title": "多选题","content": "注释"},
		]
    }
}

var num=["一","二","三","四","五","六","七","八","九","十","十一","十二","十三","十四","十五","十六","十七","十八","十九","二十","二十一","二十二","二十三","二十四","二十五","二十六","二十七","二十八","二十九","三十"];

function fixTxt(txt){
	var new1=txt.replace(/\s/g, "")//清除所有空格
	var new2=new1.replace(/<br>/g,"\n")//用回车替换<br>
	return new2
}
function addBr(txt){
	var newTxt=txt.replace(/\n|\r/g, "<br>")
	return newTxt
}

//排序方法
function sequence(){
	var sp_num=$('.testPaperBody .subPart:visible').size();
	$('.subPart:visible').each(function(sp_num) {
		$(this).children('h6').children('i').text(num[sp_num]+'.')
    });	
	
	var treeItem_num=$('.subTree li').size();
	$('.subTree li i').each(function(treeItem_num) {
		$(this).text(num[treeItem_num]+'.')
    });	
	
}




//卷体添加项目
function add_PaperPart(volumeName){
	var part=config[volumeName];
	var paperPart='<div id="'+part.id+'" class="paperPart" title='+volumeName+'><div class="testPaperTitle setup"><p>'+part.title+'</p><div class="editBar  hide"><input type="text" class="text txt"> <input class="btn okBtn" type="button" value="确定"> <input class="btn cancelBtn" type="button" value="取消"></div><span class="setupBar hide"><span class="setupBtn">编辑</span></span></div><div class="testPaperCom setup"><h6>说明:</h6><p>'+part.content+'</p><div class="editBar  hide"><input type="text" class="text txt"> <input class="btn okBtn" type="button" value="确定"> <input class="btn cancelBtn" type="button" value="取消"></div><span class="setupBar hide"><span class="setupBtn">编辑"注释"</span></span></div><div class="editBar  hide"><input type="text" class="text txt"> <input class="btn okBtn" type="button" value="确定"> <input class="btn cancelBtn" type="button" value="取消"></div><span class="setupBar hide"><span class="setupBtn">编辑"注释"</span></span></div>';
		$('.testPaperBody').append(paperPart);
		var volume='<li id="type'+part.id+'" title='+volumeName+' class="volume"><input id="'+part.id+'_chk" type="checkbox" class="checkbox" checked>'+part.title+'</li>';
		$('#testPaperBodyTree').append(volume);
		
		if(part.questions){
			var subSize=part.questions.length;
			var subTree='<ul class="subTree"></ul>';
			$('#type'+part.id).append(subTree);
			for( var i=0; i<subSize;i++){
				var subPart='<div id="'+part.questions[i].id+'" class="subPart setup"><table><thead><tr><th>评卷人</th><th>得分</th></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr></thead></table><h6><i>一.</i><em>'+part.questions[i].title+'</em></h6><p>('+part.questions[i].content+')</p><div class="editBar  hide"><input type="text" class="text txt"> <input class="btn okBtn" type="button" value="确定"> <input class="btn cancelBtn" type="button" value="取消"></div><span class="setupBar hide"><span class="setupBtn">编辑"注释"</span><span class="upBtn">上移</span><span class="downBtn">下移</span></span></div>';
				$('#'+part.id).append(subPart);
				var subTreeItem='<li><input id="'+part.questions[i].id+'_chk" type="checkbox" class="checkbox"  checked><i>一.</i> '+part.questions[i].title+'</li>';
				$('#type'+part.id).children('.subTree').append(subTreeItem);
			}
		}
		sequence()
}

//插入分卷及题目
	if(config.win_paper_typeone) add_PaperPart("win_paper_typeone")
	if(config.win_paper_typetwo) add_PaperPart("win_paper_typetwo")



//点击树上的checkbox,显示/隐藏右侧单元
	$('.testpaperSetup input').each(function(index, element) {
		var id=$(this).attr('id');
		var itemId=id.replace(/_chk/g,"");
		$('#'+id).click(function(){
			$('#'+itemId).toggle();
			//修改config
			var volume=$(this).parents('.volume').attr('title');
			var q_id=$(this).attr('id').replace(/_chk/g,"");
			var questions=config[volume].questions;
			var q_num=questions.length;
			for(var i=0; i<q_num; i++){
				if(questions[i].id==q_id||config[volume].id==q_id){
					if(questions[i].ischecked==1) questions[i].ischecked=0;
					else questions[i].ischecked=1;
					
					if(config[volume].ischecked==1) config[volume].ischecked=0;
					else config[volume].ischecked=1;
				}
			}
			sequence();	
			//console.log(config)
		})
    });


	
	
//下移
$('.setup .downBtn').live('click',function(){
	var next=$(this).parents('.subPart').next('.subPart');	
	$(next).after($(this).parents('.subPart')	)
	
	var id=$(this).parents('.subPart').attr('id');
	var tag=$('#'+id+'_chk').parent().next();
	$(tag).after($('#'+id+'_chk').parent())
	sequence()
})

//上移
$('.setup .upBtn').live('click',function(){
	var prev=$(this).parents('.subPart').prev('.subPart');	
	$(prev).before($(this).parents('.subPart'))
	
	var id=$(this).parents('.subPart').attr('id');
	var tag=$('#'+id+'_chk').parent().prev();
	$(tag).before($('#'+id+'_chk').parent())
	sequence()	
	
})


//显示编辑按钮
$('.testPaperDemo .setup').hover(
	function(){
		$(this).addClass('hover');
		if($(this).attr("edit")!="on") $(this).children('.setupBar').show();
	},
	function(){
		$(this).removeClass('hover').children('.setupBar').hide();
	}
)

$('.setupBtn').click(function(){
	$(this).parent('.setupBar').hide();
	$(this).parents('.setup').attr("edit","on")
	var oldText=$(this).parent().siblings('p').html();
	$(this).parent().siblings('.editBar').show().children('.txt').val(fixTxt(oldText));
	$(this).parent().siblings('p').hide();
})



//编辑config
$('.testPaperDemo .setup').find('.okBtn').click(function(){
	var _this=$(this).parents('.setup');
	var oldText=$(_this).children('p').text();
	var newText=$(_this).find('.txt').val();
	if(newText=="") newText=oldText
	$(_this).children('p').html(addBr(newText)).show();
	$(_this).children('.editBar').hide();
	$(_this).attr("edit","no");
	$(_this).children('.setupBar').show();
	
})

function editObj(btn,pa,objKey){//确定按钮 父级class config中属性名
	var _this=btn.parents(pa);
	var id=btn.parents('.setup').attr("id");
	var volume=btn.parents('.paperPart').attr("title");//分卷名称
	var oldText=$(_this).children('p').text();
	var newText=$(_this).find('.txt').val();
	if(newText=="") newText=oldText
	if(volume) config[volume][objKey]=newText;
	if(id && id!="pay_attention") config[id][objKey]=newText;
	if(id=="pay_attention") config[id].content=newText;
	console.log(config)
}

$('.testPaperHead').find('.okBtn').click(function(){//卷头项目
	editObj($(this),".setup","title")
})

$('.testPaperDemo .testPaperTitle').find('.okBtn').click(function(){//分卷名称
	editObj($(this),".testPaperTitle","title")
})

$('.testPaperDemo .testPaperCom').find('.okBtn').click(function(){//分卷注释
	editObj($(this),".testPaperCom","content")
	
})

$('.subPart .editBar').find('.okBtn').click(function(){ //分卷--题目注释
	var _this=$(this).parents('.subPart');
	var id=$(this).parents('.setup').attr("id");
	var volume=$(this).parents('.paperPart').attr("title");
	var oldText=$(_this).children('p').text();
	var newText=$(_this).find('.txt').val();
	if(newText==""){newText=oldText}
	
	var q_index=config[volume].questions.length;
		var questions=config[volume].questions;
		for(var i=0;i<q_index; i++){
			if(questions[i].id==id) questions[i].content=newText;
		}
	//console.log(config)
})



$('.testPaperDemo .setup').find('.cancelBtn').click(function(){
	var _this=$(this).parents('.setup');
	var oldText=$(_this).children('p').html();
	$(_this).children('p').html(oldText).show();
	$(_this).children('.editBar').hide();
	$(_this).attr("edit","no");
	$(_this).children('.setupBar').show();
})








})
</script>
</head>

<body class="teacher">
<div class="head"></div>
<!--top_end--> 
<!--主体-->
<div class="cont24">
    <div class="grid24 main">
        <div class="grid_5 main_l">
            <div class="clearfix item l_userInfo"> <img src="../../images/teacher_l.jpg"> <a style="border-right:1px solid #ddd"><em>30</em><br>
                试卷</a> <a><em>300</em><br>
                课程</a> </div>
            <div class="item l_asideMenu">
                <h4>我的档案</h4>
                <ul class="setupMenu">
                    <li><a class="lisA ac" href="javascript:;"><i></i>个人设置</a>
                        <ul class="subMenu">
                            <li><a class="ac" href="#">信息</a></li>
                            <li><a href="#">通知</a></li>
                            <li><a href="#">系统消息</a></li>
                            <li><a href="#">我的私信</a></li>
                        </ul>
                    </li>
                    <li><a class="lisB" href="javascript:;"><i></i>考试与试卷</a>
                        <ul class="subMenu hide">
                            <li><a href="#">考试管理</a></li>
                            <li><a href="#">试卷管理</a></li>
                        </ul>
                    </li>
                    <li><a class="lisC" href="javascript:;"><i></i>题目与推题</a>
                        <ul class="subMenu hide">
                            <li><a href="#">题目管理</a></li>
                            <li><a href="#">题目推送</a></li>
                        </ul>
                    </li>
                    <li><a class="lisD" href="javascript:;"><i></i>作业管理</a>
                        <ul class="subMenu hide">
                            <li><a href="#"></a></li>
                            <li><a href="#">1403班</a></li>
                            <li><a href="#">1404班</a></li>
                            <li><a href="#">1405班</a></li>
                            <li><a href="#">1406班</a></li>
                        </ul>
                    </li>
                    <li><a class="lisF" href="javascript:;"><i></i>课程管理</a>
                        <ul class="subMenu hide">
                            <li><a class="ac" href="#">课程管理</a></li>
                            <li><a href="#">评论管理</a></li>
                            <li><a href="#">课程总结</a></li>
                            <li><a href="#">家长会管理</a></li>
                        </ul>
                    </li>
                    <li><a class="lisG" href="javascript:;"><i></i>数据统计中心</a>
                        <ul class="subMenu hide">
                            <li><a href="#">班级统计</a></li>
                            <li><a href="#">熊孩子管理器</a></li>
                            <li><a href="#">个人统计</a></li>
                        </ul>
                    </li>
                    <li><a class="lisH" href="javascript:;"><i></i>教研工作</a>
                        <ul class="subMenu hide">
                            <li><a href="#">教研课题</a></li>
                            <li><a href="#">教学计划</a></li>
                            <li><a href="#">听课评课</a></li>
                            <li><a href="#">教研组资料</a></li>
                            <li><a href="#">教研日记</a></li>
                        </ul>
                    </li>
                    <li><a class="lisH" href="javascript:;"><i></i>备课</a>
                        <ul class="subMenu hide">
                            <li><a href="#"><span>公文包(教案|讲义|个人教学计划)</span></a></li>
                            <li><a href="#">资料袋</a></li>
                        </ul>
                    </li>
                    <li><a class="lisH" href="javascript:;"><i></i>我的收藏</a>
                        <ul class="subMenu hide">
                            <li><a href="#">收藏的讲义</a></li>
                            <li><a href="#">收藏的课程</a></li>
                        </ul>
                    </li>
                    <li><a class="lisH" href="javascript:;"><i></i>答疑管理</a>
                        <ul class="subMenu hide">
                            <li><a href="#">暂无内容(空)</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
        <div class="grid_19 main_r">
            <div class="main_cont  make_testpaper">
                <div class="title">
                    <h4>组卷</h4>
                </div>
               	<ul class="stepList clearfix">
                    <li class="step_finish step_ac_before"><span>试卷类型</span><i></i></li>
                    <li class="step_ac"><span>试卷结构</span><i></i></li>
                    <li><span>筛选题目</span><i></i></li>
                    <li class="step_end"><span>设定分值</span><i></i></li>
                </ul>
                <br>
                <h4>试卷结构</h4>
                <form class="form_id">
                    <div class="form_list">
                        <div class="row makePaper">
                            <div class="testpaperSetup clearBoth">
                                <h6>卷头</h6>
                                <hr>
                                <ul id="testPaperHeadTree" class="clearfix">
                                    <li>
                                        <input type="checkbox" id="line_chk" class="checkbox" checked>
                                        装订线</li>
                                    <li>
                                        <input type="checkbox" id="secret_sign_chk" class="checkbox" checked>
                                        绝密★启用前</li>
                                    <li>
                                        <input type="checkbox" id="main_title_chk" class="checkbox" checked>
                                        主标题</li>
                                    <li>
                                        <input type="checkbox" id="sub_title_chk" class="checkbox" checked>
                                        副标题</li>
                                    <li>
                                        <input type="checkbox" id="info_chk" class="checkbox" checked>
                                        范围/时间</li>
                                    <li>
                                        <input type="checkbox" id="student_input_chk" class="checkbox" checked>
                                        学生输入</li>
                                    <li>
                                        <input type="checkbox" id="pay_attention_chk" class="checkbox" checked>
                                        注意事项</li>
                                </ul>
                                <h6>卷体</h6>
                                <hr>
                                <ul id="testPaperBodyTree" class="clearfix testPaperBodyTree">
                                    <!--<li id="volume1" class="volume">
                	<input type="checkbox" class="checkbox">分卷I
                	<ul class="subTree">
                        <li><input type="checkbox" class="checkbox">单选题</li>
                    </ul>
                </li>
                <li  id="volume2" class="volume">
                	<input type="checkbox" class="checkbox">分卷I
                	<ul class="subTree">
                        <li><input type="checkbox" class="checkbox">单选题</li>
                    </ul>
                </li>-->
                                </ul>
                            </div>
                            <div class="testPaperDemo clearfix">
                                <div class="testPaperHead">
                                    <div id="line"  class="paper_bindLine"><span class="hide">装订线</span></div>
                                    <div id="secret_sign" class="paper_top">
                                        <p>绝密★启用前</p>
                                    </div>
                                    <div id="main_title" class="paper_title1 setup">
                                        <div class="setupBar hide"><span class="setupBtn">编辑</span></div>
                                        <p>2013-2014学年度xx学校xx月考卷</p>
                                        <div class="editBar  hide">
                                            <input type="text" class="text txt">
                                            <input class="btn okBtn" type="button" value="确定">
                                            <input class="btn cancelBtn" type="button" value="取消">
                                        </div>
                                    </div>
                                    <div id="sub_title" class="paper_title12 setup">
                                        <div class="setupBar hide"><span class="setupBtn">编辑</span></div>
                                        <p>试卷副标题</p>
                                        <div class="editBar  hide">
                                            <input type="text" class="text txt">
                                            <input class="btn okBtn" type="button" value="确定">
                                            <input class="btn cancelBtn" type="button" value="取消">
                                        </div>
                                    </div>
                                    <div id="info" class="paper_data setup">
                                        <div class="setupBar hide"><span class="setupBtn">编辑</span></div>
                                        <p>考试时间:
                                            <input type="text" class="text w50" readonly>
                                            分</p>
                                        <div class="editBar  hide"> 考试时间:
                                            <input type="text" class="text txt w50">
                                            分
                                            <input class="btn okBtn" type="button" value="确定">
                                            <input class="btn cancelBtn" type="button" value="取消">
                                        </div>
                                    </div>
                                    <div id="student_input" class="paper_name  setup">
                                        <div class="setupBar hide"><span class="setupBtn">编辑</span></div>
                                        <p>学校：_________姓名：________班级：________考号：_____</p>
                                        <div class="editBar  hide">
                                            <input type="text txt" class="text txt">
                                            <input class="btn okBtn" type="button" value="确定">
                                            <input class="btn cancelBtn" type="button" value="取消">
                                        </div>
                                    </div>
                                    <div class="part7">
                                        <table class="topTotalTable">
                                            <thead>
                                                <tr>
                                                    <th>题号</th>
                                                    <th>一</th>
                                                    <th>二</th>
                                                    <th>三</th>
                                                    <th>四</th>
                                                    <th>五</th>
                                                    <th>六</th>
                                                    <th>七</th>
                                                    <th>八</th>
                                                    <th>九</th>
                                                    <th>总分</th>
                                                </tr>
                                                <tr>
                                                    <td>得分</td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                </tr>
                                            </thead>
                                        </table>
                                    </div>
                                    <div id="pay_attention"  class="paper_attention setup">
                                        <div class="setupBar hide"><span class="setupBtn">编辑</span></div>
                                        <h6>注意事项：</h6>
                                        <p> 1.答题前填写好自己的姓名、班级、考号等信息<br>
                                            2.请将答案正确填写在答题卡上<br>
                                            3.请将答案正确填写在答题卡上<br>
                                            4.请将答案正确填写在答题卡上<br>
                                            5.dfsfsdfsfsdsdf </p>
                                        <div class="editBar hide ">
                                            <textarea class="txt"></textarea>
                                            <br>
                                            <input class="btn okBtn" type="button" value="确定">
                                            <input class="btn cancelBtn" type="button" value="取消">
                                        </div>
                                    </div>
                                </div>
                                <div class="testPaperBody"> </div>
                            </div>
                            <hr>
                        </div>
                    </div>
                    
                    <div class="submitBtnBar tc">
                        <button type="button" class="bg_blue btn40 w120 disableBtn">确定</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
</div>
<!--主体end-->
</body>
</html>
